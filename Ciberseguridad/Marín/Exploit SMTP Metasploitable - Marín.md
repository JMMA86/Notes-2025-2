## Estudiante
- Nombre: Juan Manuel Marín Angarita
- Código: A00382037

## Proceso de explotación
### 1. Análisis
Se conoce de antemano que existe un servicio llamado SMTP (Simple Mail Transfer Protocol) que generalmente se ejecuta en el puerto ``25``. Lo que se intentará será tratar de conectarse al mismo para ver qué información se puede extraer. Es un servicio que, si está mal configurado, puede filtrar información sensible o incluso ser utilizado como open relay.

### 2. Escaneo de puertos
Primero, ejecutamos el comando:

```
nmap -sV -p25 10.0.2.4
```

Al hacer un escaneo completo de puertos observamos que, en efecto, el puerto ``25`` corresponde al SMTP:

![[Pasted image 20250928144853.png]]

### 3. Conexión al puerto
Tratamos de conectarnos al puerto ``25`` utilizando ``nc``:

![[Pasted image 20250928145235.png]]

Esto nos devuelve un banner con información del servicio, incluyendo:

- Nombre del host
- Versión del servidor SMTP en uso

### 4. Enumeración de usuarios
Probamos comandos como ``VRFY root`` o para comprobar si el servidor responde confirmando usuarios válidos:

![[Pasted image 20250928145910.png]]

Dado que la respuesta confirma al usuario, podemos recopilar una lista de cuentas activas en el sistema. Esto significa que, a través del puerto 25, podemos revisar qué usuarios existen para utilizarlos con otro ataque posterior.

![[Pasted image 20250928151109.png]]

### 5. Uso de ``smtp-user-enum``
En Kali existe ya una herramienta que automatiza este proceso con una lista de usuarios posibles para determinar si es posible comprobar que ya existan o no. Se utiliza una wordlist de usuarios y se escanea usando el comando:

```
smtp-user-enum -M VRFY -U /usr/share/metasploit-framework/data/wordlists/unix_users.txt -t 10.0.2.4
```

![[Pasted image 20250928151501.png]]

Como se puede observar, la herramienta confirma la existencia de múltiples usuarios dentro del sistema objetivo.

### 6. Explotación con la información obtenida
Con los usuarios válidos, se procede a un ataque de fuerza bruta en SSH usando la herramienta **hydra**. Antes de proceder, se edita la wordlist por defecto agregando los nombres de usuario encontrados como contraseñas para cubrir el caso en el que estos sean iguales, lo que es muy común en entornos no seguros.

```
hydra -l msfadmin -P /usr/share/wordlists/rockyou.txt ssh://10.0.2.4
```

Se ejecuta el comando:

![[Pasted image 20250928162737.png]]

Como se puede observar, hydra encontró que el usuario ``msfadmin`` tiene la contraseña ``msfadmin``, por lo que podemos acceder al mismo:

![[Pasted image 20250928162858.png]]

### 7. Escalada de privilegios
Comprobamos que el usuario tenga permisos root:

![[Pasted image 20250928162951.png]]

Dado que sí tiene, accedemos:

![[Pasted image 20250928163018.png]]

Ya estamos dentro del sistema con permisos root totales.

### 8. Corregir vulnerabilidad
1. Se cambió la contraseña del usuario ``msfadmin`` a ``cursociber`` para mejorar la seguridad del usuario.
2. Se agregó en el archivo de configuración de SSH que solo se pueda iniciar sesión con el usuario msfadmin pero sin permisos root:

![[Pasted image 20250928163926.png]]

3. Se agregó en el archivo de configuración de postfix la restricción para el uso de comandos como ``VRFY`` o ``EXPN``:

![[Pasted image 20250928164443.png]]

Al reiniciar el servicio y volver a probar desde Kali, ya no se puede ver si el usuario existe o no:

![[Pasted image 20250928164751.png]]

4. Se eliminó la información sensible del banner para no mostrar la versión del servicio ni del host:

![[Pasted image 20250928165033.png]]

De esta forma, al volver a hacer ``nc``:

![[Pasted image 20250928165123.png]]

Con esto, se corrige la vulnerabilidad explicada.

### 7. Conclusiones
Durante el proceso de explotación del servicio SMTP en Metasploitable se logró identificar que:

- El puerto **25 (SMTP)** se encuentra abierto y expone información sensible a través de su banner, revelando detalles del host y del software utilizado.
- Es posible utilizar comandos como **VRFY** para confirmar la existencia de usuarios locales en el sistema, lo que constituye una vulnerabilidad de **enumeración de usuarios**.
- Herramientas como **smtp-user-enum** permiten automatizar este proceso y obtener listas de usuarios válidos de manera más eficiente, reduciendo el esfuerzo para un atacante.
- La información obtenida no concede acceso directo al sistema, pero sí sirve como punto de partida para ataques posteriores, por ejemplo:

    - **Fuerza bruta en SSH o FTP** utilizando los usuarios confirmados.
    - **Explotación de otros servicios** al contar con cuentas válidas.
    - Posible uso del servidor como **open relay** en entornos mal configurados para enviar spam o phishing.

Por lo tanto, el servicio SMTP en Metasploitable constituye una vulnerabilidad importante porque expone información crítica de usuarios y del sistema que facilita ataques más avanzados. Aunque no permite un acceso inmediato por sí solo, sí reduce significativamente las barreras para comprometer otros servicios activos en la máquina víctima. Además, se accedió al sistema como root y se explicaron los pasos seguidos para corregir la vulnerabilidad.
